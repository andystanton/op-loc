<!DOCTYPE html>
<html>
<head>
    <title>Optimum Locum</title>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCx3LJgxX7QqjEQE6GfdUeFFnlgQPK3XTo"></script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script src="bower_components/handlebars/handlebars.min.js"></script>
    <script src="bower_components/typeahead.js/dist/typeahead.bundle.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
</head>
<body>
<div class="navbar navbar-custom navbar-fixed-top">
    <div class="navbar-header">
        <a class="navbar-brand" href="#">Optimum Locum</a>
        <a class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>
    </div>
    <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#">Link</a></li>
            <li><a href="#">Link</a></li>
            <li>&nbsp;</li>
        </ul>

        <input class="typeahead"
               placeholder="I'm thinking about a move to..."
               id="locations"
               type="text" />
    </div>
</div>

<div id="map-canvas"></div>
<div class="container-fluid" id="main">
    <div class="row">
        <div class="col-xs-8"><!--map-canvas will be postioned here--></div>
        <div class="col-xs-4" id="left">

            <h2>Bootstrap Google Maps Demo</h2>

            <!-- item list -->
            <div class="panel panel-default">
                <div class="panel-heading"><a href="">Item heading</a></div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
                Aliquam in felis sit amet augue.</p>

            <hr>

            <div class="panel panel-default">
                <div class="panel-heading"><a href="">Item heading</a></div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
                Aliquam in felis sit amet augue.</p>

            <hr>

            <div class="panel panel-default">
                <div class="panel-heading"><a href="">Item heading</a></div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
                Aliquam in felis sit amet augue.</p>

            <hr>

            <div class="panel panel-default">
                <div class="panel-heading"><a href="">Item heading</a></div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
                dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
                Aliquam in felis sit amet augue.</p>

            <hr>
            <!-- /item list -->

            <p>
                <a href="http://www.bootply.com/render/129229">Demo</a> | <a href="http://bootply.com/129229">Source
                Code</a>
            </p>

            <hr>

            <p>
                <a href="http://bootply.com" target="_ext" class="center-block btn btn-primary">More Bootstrap Snippets
                    on Bootply</a>
            </p>

            <hr>

        </div>


    </div>
</div>
<!-- end template -->

<script type="text/javascript">
var marker;
var nearmarkers;
var markerRange;

$(document).ready(function() {
    $('#locations').on('typeahead:selected', function(event, selection) {
        if (marker != undefined) marker.setMap(null);
        var lat = selection.latlong.latitude;
        var lng = selection.latlong.longitude;

        marker = new google.maps.Marker({
            position: new google.maps.LatLng(lat,lng),
            map: map,
            title: selection.name
        });
        map.panTo(new google.maps.LatLng(lat,lng));
        map.setZoom(10);

        if (markerRange != undefined) markerRange.setMap(null);
        var rangeOptions = {
          strokeColor: '#0000FF',
          strokeOpacity: 0.4,
          strokeWeight: 2,
          fillColor: '#0000FF',
          fillOpacity: 0.15,
          map: map,
          center: marker.position,
          radius: 10000
        };
        // Add the circle for this city to the map.
        markerRange = new google.maps.Circle(rangeOptions);

        $.getJSON("find/near/" + selection.id, function (data) {
            if (nearmarkers != undefined) {
                for (var i = 0; i < nearmarkers.length; i++) {
                    nearmarkers[i].setMap(null);
                }
            }
            nearmarkers = new Array();
            for (var i = 0; i < data.length; i++) {
                var nearby = data[i];
                var lat = nearby.latlong.latitude;
                var lng = nearby.latlong.longitude;

                nearmarkers[i] = new google.maps.Marker({
                    position: new google.maps.LatLng(lat,lng),
                    map: map,
                    title: nearby.name
                });
            }
        });
    });

    var map;
    function initialize() {
        var mapOptions = {
            center: new google.maps.LatLng(51.51279, -0.09184),
            zoom: 8,
            disableDefaultUI: true
        };
        map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
    }
    google.maps.event.addDomListener(window, 'load', initialize);


    var remoteLocations = new Bloodhound({
      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
      queryTokenizer: Bloodhound.tokenizers.whitespace,
      remote: 'find/name/%QUERY'
    });

    remoteLocations.initialize();

    $('#locations').typeahead(null, {
      name: 'remote-locations',
      displayKey: 'name',
      source: remoteLocations.ttAdapter(),
      templates: {
        empty: [
          '<div class="empty_message"><p><strong>No matches</strong></p></div>'
        ].join('\n'),
        suggestion: Handlebars.compile('<p><strong>{{name}}</strong> ({{latlong.latitude}}, {{latlong.longitude}})</p>')
      }
    });
});
</script>
</body>
</html>